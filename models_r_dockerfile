
# Runtime stage
# FROM mcr.microsoft.com/dotnet/runtime:8.0 AS build
# The R sensitivity package seems to have a dependency on shiny - not sure why
FROM rocker/shiny:4.3.1 AS r-base
 
# Install R package dependencies
RUN R -q -e 'install.packages(c("sensitivity"), repos = "https://cran.csiro.au/")'

COPY entrypoint.sh /entrypoint.sh
COPY ./app /app
COPY ./Prototypes /validation_files/Prototypes
COPY ./Examples /validation_files/Examples
COPY ./Tests/UnderReview /validation_files/Tests/UnderReview
COPY ./Tests/Validation /validation_files/Tests/Validation
COPY ./Tests/Simulation /validation_files/Tests/Simulation
COPY ./Tests/WeatherFiles /validation_files/Tests/WeatherFiles

USER root
RUN apt update -q --silent && \
    apt install -yq libsqlite3-dev &&\
    apt install -y dotnet-runtime-8.0
# Add models to path
ENV PATH=$PATH:/app
RUN echo $PATH
# This works to run a models dll.
RUN ["chmod", "+x", "/entrypoint.sh"]
ENTRYPOINT ["/entrypoint.sh"] 
