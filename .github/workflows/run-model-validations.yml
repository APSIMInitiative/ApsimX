name: Run model validations
permissions:
  contents: read # access to check out code and install dependencies

env:
  APSIM_WORKFLOW_DLL_LOCATION: "/home/runner/work/ApsimX/ApsimX/APSIM.Workflow/bin/Release/net8.0/APSIM.Workflow.dll"
  APSIM_FILE_DIR_TO_RUN_LOCATION: "/home/runner/work/ApsimX/ApsimX/Tests/Validation/WorkFloTest/" 
  ALL_APSIM_FILES: ""

# Determines when this workflow is triggered. 
on:
  push:
  pull_request:
    branches: [ master ]

jobs:
  run-model-validations:
    name: run-model-validations
    runs-on: ubuntu-latest
    env:
      ALL_APSIM_FILES: ""
    steps:
    - uses: actions/checkout@v4

    - name: Setup .NET Core
      uses: actions/setup-dotnet@v4

    - name: Build
      run: dotnet build --configuration Release

    - name: Get current directory
      run: echo $pwd

    - name: Find all apsimx files in the repository
      run: echo $(find . -not \( -path ./Tests/UnitTests -prune \) -not \( -path ./ApsimNG -prune \)  -name '*.apsimx')

    - name: Print all the file names
      run: echo $ALL_APSIM_FILES

    # - name: Add env to directory before zipping
    #   run:  echo "${{ secrets.AZURE_ENV_CONTENTS }}" > ${{ env.APSIM_FILE_DIR_TO_RUN_LOCATION }}.env 

    # - name: Run a validation via WorkFlo on Azure
    #   run: dotnet ${{ env.APSIM_WORKFLOW_DLL_LOCATION }} ${{ env.APSIM_FILE_DIR_TO_RUN_LOCATION }} --verbose 